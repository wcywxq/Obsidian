---
title: 图片加载数量限制
url: https://www.yuque.com/wcywxq/sd8kbc/xz2gy5
---

考察`promise`并发控制

```javascript
function limitLoad(urls, handler, limit) {
	const sequence = [].concat(urls)
  let promises = []
  promises = sequence.splice(0, limit).map((url, index) => {
  	return handler(url).then(() => index)
  })
  
  let p = Promise.race(promises)
  for (let i = 0; i < sequence.length; i++) {
  	p = p.then(res => {
    	promises[res] = handler(sequence[i]).then(() => res)
      return Promise.race(promises)
    })
  }
}

// 设置要执行的任务
function loadImage(url) {
	return new Promise((resolve, reject) => {
  	console.log(`---${url.info} start!`)
    setTimeout(() => {
      console.log(`${url.info} ok!`)
      resolve()
    }, url.time)
  })
}

limitLoad(urls, loadImage, 3)
```
