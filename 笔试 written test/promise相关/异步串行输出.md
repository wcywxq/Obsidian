---
title: 异步串行输出
url: https://www.yuque.com/wcywxq/sd8kbc/um4g6z
---

实现 createFlow 按照 a、b，延时 1s，c，延时 1s，d，e，done 顺序打印

```javascript
const log = console.log
const delay = ms => new Promise(resolve => setTimeout(resolve, ms))
const subFlow = createFlow([() => delay(1000).then(() => log('c'))])
createFlow([
  () => log('a'), 
  () => log('b'), 
  subFlow, 
  [
    () => delay(1000).then(() => log('d')), 
    () => log('e')
  ]
]).run(() => {
	log('done')
})

function createFlow(iterator = []) {
	return {
  	run(cb = () => {}) {
    	return [...iterator, cb].reduce((prev, cur) => {
      	return prev.then(
          Array.isArray(cur) ? 
          	createFlow(cur).run : 
          		cur.hasOwnProperty('run') ? 
          			cur.run : 
          			cur
        )
      }, Promise.resolve())
    }
  }
}
```
