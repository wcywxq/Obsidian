{
  "id": 72212267,
  "slug": "zbte28",
  "title": "ESM 、 esbuild、rollup",
  "book_id": 26225124,
  "book": {
    "id": 26225124,
    "type": "Book",
    "slug": "mxunh7",
    "name": "八股文 eight-part essay writing",
    "user_id": 732231,
    "description": "前端八股文",
    "creator_id": 732231,
    "public": 0,
    "items_count": 239,
    "likes_count": 0,
    "watches_count": 1,
    "content_updated_at": "2023-11-11T18:15:57.023Z",
    "updated_at": "2023-11-11T18:15:57.000Z",
    "created_at": "2022-04-04T11:31:45.000Z",
    "namespace": "wcywxq/mxunh7",
    "user": {
      "id": 732231,
      "type": "User",
      "login": "wcywxq",
      "name": "magic",
      "description": null,
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/732231/1606968271774-avatar/886ad88b-d2cc-4c9e-a674-f70eb51a679c.png",
      "books_count": 18,
      "public_books_count": 0,
      "followers_count": 0,
      "following_count": 0,
      "created_at": "2020-01-08T14:21:31.000Z",
      "updated_at": "2023-11-13T09:32:35.000Z",
      "_serializer": "v2.user"
    },
    "_serializer": "v2.book"
  },
  "user_id": 732231,
  "creator": {
    "id": 732231,
    "type": "User",
    "login": "wcywxq",
    "name": "magic",
    "description": null,
    "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/732231/1606968271774-avatar/886ad88b-d2cc-4c9e-a674-f70eb51a679c.png",
    "books_count": 18,
    "public_books_count": 0,
    "followers_count": 0,
    "following_count": 0,
    "created_at": "2020-01-08T14:21:31.000Z",
    "updated_at": "2023-11-13T09:32:35.000Z",
    "_serializer": "v2.user"
  },
  "format": "lake",
  "body": "<a name=\"cZTZn\"></a>\n## ESM\nESM 是 es6 出现后，浏览器支持的一种模块化方案，允许在浏览器实现模块化。与 CommonJS、AMD 不同，ESM 对外借口只是一种静态定义，为编译时记载，遇到模块加载命令 import，就会生成一个只读引用。等脚本真正执行时，再根据这个只读引用，到被加载的那个模块内取值。由于 ESM 编译时就能确定模块的依赖关系，因此能够只包含要运行的代码，可以显著减少文件体积，降低浏览器压力。\n\n以下为其浏览器的支持能力：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/732231/1648048044646-2af9cb9a-e215-4d1b-b63f-b40ea00780e7.png#clientId=u2d1aa443-6142-4&from=paste&height=222&id=uc6a329fc&originHeight=222&originWidth=720&originalType=binary&ratio=1&rotation=0&showTitle=false&size=179799&status=done&style=none&taskId=u1c7709dd-3545-418e-845a-8f8610ddfe6&title=&width=720)\n\n- ESM 的解析过程\n```vue\n<template>\n  <img alt='Vue logo' src='./assets/logo.png' />\n  <HelloWorld msg='Hello Vue 3.0 + Vite' />\n</template>\n\n<script script='setup'>\n  import HelloWorld from './components/HelloWorld.vue'\n</script>\n```\n当浏览器解析 `import HelloWorld from './components/HelloWorld.vue'` 时，会向当前于i域名发送一个请求获取对应的资源 (ESM 支持解析相对路径)。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/732231/1648048297903-a2968f11-ea42-4f2c-9b78-38165af6dddf.png#clientId=u2d1aa443-6142-4&from=paste&height=144&id=uc8917cf7&originHeight=144&originWidth=720&originalType=binary&ratio=1&rotation=0&showTitle=false&size=77196&status=done&style=none&taskId=u56073992-4d54-4242-8f94-6264fabe417&title=&width=720)<br />浏览器下载对应的资源，然后解析成模块记录。接下来会进行实例化，为模块分配内存，然后按照导入、导出语句建立模块和内存的映射关系。最后，运行上述代码，把内存空间填充为真实的值。\n<a name=\"KyarL\"></a>\n## esbuild\nvite 采用 esbuild 进行打包，esbuild 是一个全新的 js 打包工具，支持如 babel、压缩等功能。其底层使用了 go 语言实现，整体打包会快 10 ～ 100 倍。同时大量使用了并行操作，可以充分利用 cpu 资源。\n\n- esbuild 对比 其他打包工具如下：\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/732231/1648048411757-695df03b-4d10-4d26-a40f-2d118244cf32.png#clientId=u2d1aa443-6142-4&from=paste&height=289&id=udf3a44f1&originHeight=289&originWidth=720&originalType=binary&ratio=1&rotation=0&showTitle=false&size=120172&status=done&style=none&taskId=ud14dd21f-c0eb-4b33-acdd-3a8707ae381&title=&width=720)\n\n- esbuild 支持以下的功能：\n   - 加载器\n   - 压缩\n   - 打包\n   - tree-shaking\n   - source map 生成\n:::info\nesbuild 总共提供了四个函数：transform、build、buildSync、Service\n:::\n<a name=\"GSb0p\"></a>\n## rollup\n在生产环境下，vite 使用 rollup 来进行打包\n\nrollup 是基于 ESM 的 javaScript 打包工具，相比于 webpack，他总能打出更小、更快的包。因为 rollup 基于 ESM 模块，比 webpack 和 Browserify 使用的 CommonJS 模块机制更高效。rollup 的亮点在于同一个地方，一次性加载。能针对源码进行 tree shaking，以及 scope hoisting 以减小输出文件大小，提升运行性能。\n\nrollup 分为 build(构建) 阶段和 output generate(输出生成) 阶段。主要过程如下：\n\n1. 获取入口文件的内容，包装成 module，生成 ast\n2. 对入口文件 ast 进行依赖解析\n3. 生成最终代码\n4. 写入目标文件\n",
  "body_draft": "",
  "body_html": "<!doctype html><h2 id=\"cZTZn\"><span>ESM</span></h2><p data-lake-id=\"u356a42a3\"><span>ESM 是 es6 出现后，浏览器支持的一种模块化方案，允许在浏览器实现模块化。与 CommonJS、AMD 不同，ESM 对外借口只是一种静态定义，为编译时记载，遇到模块加载命令 import，就会生成一个只读引用。等脚本真正执行时，再根据这个只读引用，到被加载的那个模块内取值。由于 ESM 编译时就能确定模块的依赖关系，因此能够只包含要运行的代码，可以显著减少文件体积，降低浏览器压力。</span></p><p data-lake-id=\"u32bf5a17\"><span>​</span><br /></p><p data-lake-id=\"u7d21738d\"><span>以下为其浏览器的支持能力：</span></p><p data-lake-id=\"ubd094e1f\"><img alt=\"image.png\" src=\"https://cdn.nlark.com/yuque/0/2022/png/732231/1648048044646-2af9cb9a-e215-4d1b-b63f-b40ea00780e7.png#clientId=u2d1aa443-6142-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=222&amp;id=uc6a329fc&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=222&amp;originWidth=720&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=179799&amp;status=done&amp;style=none&amp;taskId=u1c7709dd-3545-418e-845a-8f8610ddfe6&amp;title=&amp;width=720\" style=\"max-width: 600px; width: 720px;\" /></p><ul><li><span>ESM 的解析过程</span></li></ul><pre data-lang=\"vue\"><code>&lt;template&gt;\n  &lt;img alt='Vue logo' src='./assets/logo.png' /&gt;\n  &lt;HelloWorld msg='Hello Vue 3.0 + Vite' /&gt;\n&lt;/template&gt;\n\n&lt;script script='setup'&gt;\n  import HelloWorld from './components/HelloWorld.vue'\n&lt;/script&gt;</code></pre><p data-lake-id=\"ua68aec6d\"><span>当浏览器解析 </span><code><span>import HelloWorld from './components/HelloWorld.vue'</span></code><span> 时，会向当前于i域名发送一个请求获取对应的资源 (ESM 支持解析相对路径)。</span></p><p data-lake-id=\"ua892a23d\"><img alt=\"image.png\" src=\"https://cdn.nlark.com/yuque/0/2022/png/732231/1648048297903-a2968f11-ea42-4f2c-9b78-38165af6dddf.png#clientId=u2d1aa443-6142-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=144&amp;id=uc8917cf7&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=144&amp;originWidth=720&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=77196&amp;status=done&amp;style=none&amp;taskId=u56073992-4d54-4242-8f94-6264fabe417&amp;title=&amp;width=720\" style=\"max-width: 600px; width: 720px;\" /></p><p data-lake-id=\"ub29acaed\"><span>浏览器下载对应的资源，然后解析成模块记录。接下来会进行实例化，为模块分配内存，然后按照导入、导出语句建立模块和内存的映射关系。最后，运行上述代码，把内存空间填充为真实的值。</span></p><h2 id=\"KyarL\"><span>esbuild</span></h2><p data-lake-id=\"uc15a6e48\"><span>vite 采用 esbuild 进行打包，esbuild 是一个全新的 js 打包工具，支持如 babel、压缩等功能。其底层使用了 go 语言实现，整体打包会快 10 ～ 100 倍。同时大量使用了并行操作，可以充分利用 cpu 资源。</span></p><ul><li><span>esbuild 对比 其他打包工具如下：</span></li></ul><p data-lake-id=\"ued5cbfce\"><img alt=\"image.png\" src=\"https://cdn.nlark.com/yuque/0/2022/png/732231/1648048411757-695df03b-4d10-4d26-a40f-2d118244cf32.png#clientId=u2d1aa443-6142-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=289&amp;id=udf3a44f1&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=289&amp;originWidth=720&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=120172&amp;status=done&amp;style=none&amp;taskId=ud14dd21f-c0eb-4b33-acdd-3a8707ae381&amp;title=&amp;width=720\" style=\"max-width: 600px; width: 720px;\" /></p><ul><li><span>esbuild 支持以下的功能：</span></li></ul><ul data-lake-indent=\"1\"><li><span>加载器</span></li><li><span>压缩</span></li><li><span>打包</span></li><li><span>tree-shaking</span></li><li><span>source map 生成</span></li></ul><blockquote class=\"lake-alert lake-alert-info\"><p data-lake-id=\"u3c532b99\"><span>esbuild 总共提供了四个函数：transform、build、buildSync、Service</span></p></blockquote><h2 id=\"GSb0p\"><span>rollup</span></h2><p data-lake-id=\"uc736da0b\"><span>在生产环境下，vite 使用 rollup 来进行打包</span></p><p data-lake-id=\"u4435d33e\"><span>​</span><br /></p><p data-lake-id=\"u79db7e19\"><span>rollup 是基于 ESM 的 javaScript 打包工具，相比于 webpack，他总能打出更小、更快的包。因为 rollup 基于 ESM 模块，比 webpack 和 Browserify 使用的 CommonJS 模块机制更高效。rollup 的亮点在于同一个地方，一次性加载。能针对源码进行 tree shaking，以及 scope hoisting 以减小输出文件大小，提升运行性能。</span></p><p data-lake-id=\"u37026913\"><br /></p><p data-lake-id=\"u04f72bc5\"><span>rollup 分为 build(构建) 阶段和 output generate(输出生成) 阶段。主要过程如下：</span></p><ol><li><span>获取入口文件的内容，包装成 module，生成 ast</span></li><li><span>对入口文件 ast 进行依赖解析</span></li><li><span>生成最终代码</span></li><li><span>写入目标文件</span></li></ol>",
  "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"adapt\" /><h2 data-lake-id=\"cZTZn\" id=\"cZTZn\"><span data-lake-id=\"u73b345e3\" id=\"u73b345e3\">ESM</span></h2><p data-lake-id=\"u356a42a3\" id=\"u356a42a3\"><span data-lake-id=\"ubcb0e825\" id=\"ubcb0e825\">ESM 是 es6 出现后，浏览器支持的一种模块化方案，允许在浏览器实现模块化。与 CommonJS、AMD 不同，ESM 对外借口只是一种静态定义，为编译时记载，遇到模块加载命令 import，就会生成一个只读引用。等脚本真正执行时，再根据这个只读引用，到被加载的那个模块内取值。由于 ESM 编译时就能确定模块的依赖关系，因此能够只包含要运行的代码，可以显著减少文件体积，降低浏览器压力。</span></p><p data-lake-id=\"u32bf5a17\" id=\"u32bf5a17\"><span data-lake-id=\"ub23883c1\" id=\"ub23883c1\">​</span><br></p><p data-lake-id=\"u7d21738d\" id=\"u7d21738d\"><span data-lake-id=\"u9a65d4b2\" id=\"u9a65d4b2\">以下为其浏览器的支持能力：</span></p><p data-lake-id=\"ubd094e1f\" id=\"ubd094e1f\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F732231%2F1648048044646-2af9cb9a-e215-4d1b-b63f-b40ea00780e7.png%22%2C%22taskId%22%3A%22u1c7709dd-3545-418e-845a-8f8610ddfe6%22%2C%22clientId%22%3A%22u2d1aa443-6142-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A720%2C%22height%22%3A222%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A179799%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A720%2C%22originHeight%22%3A222%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22USAGA%20%25OF%20ALL%20USERS%20JAVASCRIPT%20MODULES%3ADYNAMIC%20IMPORT()%20OTHER%20GLOBAL%2091.55%25%2B0.37%2591.92%25%20LOADING%20JAVASCRIPT%20MODULES%20DYNAMICALLY%20USING%20THE%20IMPORTP%20SYNTAX%20QINSITALIGNED%20USAGE%20RELATIVE%20RELATE%20RELATIVE%20CHROME%20BROWSER%20FIREFOX%20FOR%20KALOS%20ANDROID%20OPERA%20BALDU%20SAMSUNG%20QQ%20CHROMESAFANI%20OPERA%20IOS%20SAFARI%20OP%20FOR%20IEDGEDGE%20FOR%20ARI%20OPERA%20MINI%20FIREFOX%20BROWSER%20ANDROID%20MOBILE%20BROWSER%20INTERNET%20BROWSER%20BROWSER%20ANDROID%20ANDROID%202-65%203.2-10.3%204-7.4%203.111%2010-49%204-62%2012-18%208.2-11.2%2063-84%206-10%2011.1-13%2012-12.1%2050-69%2079-83%2067-79%2011-13.3%202.1-4.4.4%2012.12%2085%2079%2010.4%2070%2012.0%2013.1%2081%2084%2046%2084%207.12%2080%2013.5%2086-88%2014-TP%2081-82%2014.0%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A498.04807%2C%22y%22%3A3.7821553%2C%22width%22%3A22.293830000000014%2C%22height%22%3A8.5151287%2C%22text%22%3A%22USAGA%22%7D%2C%7B%22x%22%3A621.51245%2C%22y%22%3A4.0003%2C%22width%22%3A44.740150000000085%2C%22height%22%3A7.3421425000000005%2C%22text%22%3A%22%25OF%20ALL%20USERS%22%7D%2C%7B%22x%22%3A1.7674538%2C%22y%22%3A5.3955636%2C%22width%22%3A250.3867162%2C%22height%22%3A16.168223400000002%2C%22text%22%3A%22JAVASCRIPT%20MODULES%3ADYNAMIC%20IMPORT()%22%7D%2C%7B%22x%22%3A269.65097%2C%22y%22%3A9.261821%2C%22width%22%3A31.44903000000005%2C%22height%22%3A10.719687000000002%2C%22text%22%3A%22OTHER%22%7D%2C%7B%22x%22%3A500.71976%2C%22y%22%3A17.119743%2C%22width%22%3A27.908290000000022%2C%22height%22%3A9.706339%2C%22text%22%3A%22GLOBAL%22%7D%2C%7B%22x%22%3A596.97034%2C%22y%22%3A18.292631%2C%22width%22%3A113.85876000000007%2C%22height%22%3A9.732212%2C%22text%22%3A%2291.55%25%2B0.37%2591.92%25%22%7D%2C%7B%22x%22%3A2.0513914%2C%22y%22%3A31.266088%2C%22width%22%3A234.6979486%2C%22height%22%3A12.067922%2C%22text%22%3A%22LOADING%20JAVASCRIPT%20MODULES%20DYNAMICALLY%20USING%20THE%20IMPORTP%22%7D%2C%7B%22x%22%3A2.6219976%2C%22y%22%3A45.6207%2C%22width%22%3A31.1751104%2C%22height%22%3A9.44621%2C%22text%22%3A%22SYNTAX%22%7D%2C%7B%22x%22%3A7.7742276%2C%22y%22%3A67.83928%2C%22width%22%3A193.8731524%2C%22height%22%3A10.390044000000003%2C%22text%22%3A%22QINSITALIGNED%20USAGE%20RELATIVE%20RELATE%20RELATIVE%22%7D%2C%7B%22x%22%3A427.05872%2C%22y%22%3A96.63209%2C%22width%22%3A29.322600000000023%2C%22height%22%3A8.088189999999997%2C%22text%22%3A%22CHROME%22%7D%2C%7B%22x%22%3A510.54318%2C%22y%22%3A96.96695%2C%22width%22%3A28.110019999999963%2C%22height%22%3A7.274799999999999%2C%22text%22%3A%22BROWSER%22%7D%2C%7B%22x%22%3A465.1636%2C%22y%22%3A102.23238%2C%22width%22%3A36.13486%2C%22height%22%3A8.540589999999995%2C%22text%22%3A%22FIREFOX%20FOR%22%7D%2C%7B%22x%22%3A676.89%2C%22y%22%3A102.61691%2C%22width%22%3A24.16664000000003%2C%22height%22%3A8.65652%2C%22text%22%3A%22KALOS%22%7D%2C%7B%22x%22%3A344.66663%2C%22y%22%3A102.71122%2C%22width%22%3A31.62637000000001%2C%22height%22%3A7.955444%2C%22text%22%3A%22ANDROID%22%7D%2C%7B%22x%22%3A390.05457%2C%22y%22%3A102.79311%2C%22width%22%3A23.73885999999999%2C%22height%22%3A8.492840000000001%2C%22text%22%3A%22OPERA%22%7D%2C%7B%22x%22%3A636.5766%2C%22y%22%3A102.96485%2C%22width%22%3A21.33825999999999%2C%22height%22%3A7.718959999999996%2C%22text%22%3A%22BALDU%22%7D%2C%7B%22x%22%3A549.3743%2C%22y%22%3A103.44055%2C%22width%22%3A31.515300000000025%2C%22height%22%3A7.704065%2C%22text%22%3A%22SAMSUNG%22%7D%2C%7B%22x%22%3A599.6859%2C%22y%22%3A103.52462%2C%22width%22%3A12.788600000000088%2C%22height%22%3A7.111490000000003%2C%22text%22%3A%22QQ%22%7D%2C%7B%22x%22%3A137.33968%2C%22y%22%3A104.70016%2C%22width%22%3A164.61312000000004%2C%22height%22%3A12.006730000000005%2C%22text%22%3A%22CHROMESAFANI%20OPERA%20IOS%20SAFARI%20OP%22%7D%2C%7B%22x%22%3A431.3475%2C%22y%22%3A104.43279%2C%22width%22%3A18.71533999999997%2C%22height%22%3A8.61360400000001%2C%22text%22%3A%22FOR%22%7D%2C%7B%22x%22%3A23.199728%2C%22y%22%3A105.33978%2C%22width%22%3A58.212892000000004%2C%22height%22%3A11.034570000000002%2C%22text%22%3A%22IEDGEDGE%22%7D%2C%7B%22x%22%3A513.7452%2C%22y%22%3A105.602425%2C%22width%22%3A19.28904%2C%22height%22%3A7.024231%2C%22text%22%3A%22FOR%22%7D%2C%7B%22x%22%3A287.70508%2C%22y%22%3A105.78608%2C%22width%22%3A50.42505%2C%22height%22%3A9.469480000000004%2C%22text%22%3A%22ARI%20OPERA%20MINI%22%7D%2C%7B%22x%22%3A100.01826%2C%22y%22%3A106.32861%2C%22width%22%3A25.496520000000004%2C%22height%22%3A8.136930000000007%2C%22text%22%3A%22FIREFOX%22%7D%2C%7B%22x%22%3A343.199%2C%22y%22%3A111.04359%2C%22width%22%3A31.432379999999966%2C%22height%22%3A7.672160000000005%2C%22text%22%3A%22BROWSER%22%7D%2C%7B%22x%22%3A466.4479%2C%22y%22%3A111.08072%2C%22width%22%3A32.39634000000001%2C%22height%22%3A8.147154999999998%2C%22text%22%3A%22ANDROID%22%7D%2C%7B%22x%22%3A387.90723%2C%22y%22%3A111.15269%2C%22width%22%3A26.16194999999999%2C%22height%22%3A7.922079999999994%2C%22text%22%3A%22MOBILE%22%7D%2C%7B%22x%22%3A589.8792%2C%22y%22%3A111.6721%2C%22width%22%3A32.492200000000025%2C%22height%22%3A6.865110000000001%2C%22text%22%3A%22BROWSER%22%7D%2C%7B%22x%22%3A549.16614%2C%22y%22%3A111.76914%2C%22width%22%3A33.40965999999992%2C%22height%22%3A7.015920000000008%2C%22text%22%3A%22INTERNET%22%7D%2C%7B%22x%22%3A673.6309%2C%22y%22%3A111.956696%2C%22width%22%3A30.55714999999998%2C%22height%22%3A7.180564000000004%2C%22text%22%3A%22BROWSER%22%7D%2C%7B%22x%22%3A632.17316%2C%22y%22%3A111.96069%2C%22width%22%3A29.6961%2C%22height%22%3A6.356849999999994%2C%22text%22%3A%22BROWSER%22%7D%2C%7B%22x%22%3A426.75473%2C%22y%22%3A113.00387%2C%22width%22%3A30.802070000000015%2C%22height%22%3A8.372899999999987%2C%22text%22%3A%22ANDROID%22%7D%2C%7B%22x%22%3A508.58337%2C%22y%22%3A113.432045%2C%22width%22%3A30.73798000000005%2C%22height%22%3A8.375900000000001%2C%22text%22%3A%22ANDROID%22%7D%2C%7B%22x%22%3A101.74795%2C%22y%22%3A129.33333%2C%22width%22%3A21.96826%2C%22height%22%3A8.66667000000001%2C%22text%22%3A%222-65%22%7D%2C%7B%22x%22%3A260.61502%2C%22y%22%3A146.52638%2C%22width%22%3A33.67428000000001%2C%22height%22%3A10.13431%2C%22text%22%3A%223.2-10.3%22%7D%2C%7B%22x%22%3A552.69745%2C%22y%22%3A146.57779%2C%22width%22%3A25.377200000000016%2C%22height%22%3A9.30098000000001%2C%22text%22%3A%224-7.4%22%7D%2C%7B%22x%22%3A179.79564%2C%22y%22%3A146.62692%2C%22width%22%3A29.697339999999997%2C%22height%22%3A10.031849999999991%2C%22text%22%3A%223.111%22%7D%2C%7B%22x%22%3A222.56416%2C%22y%22%3A146.70879%2C%22width%22%3A26.85820000000001%2C%22height%22%3A10.202410000000015%2C%22text%22%3A%2210-49%22%7D%2C%7B%22x%22%3A143.0577%2C%22y%22%3A146.7134%2C%22width%22%3A21.51106999999999%2C%22height%22%3A9.260739999999998%2C%22text%22%3A%224-62%22%7D%2C%7B%22x%22%3A59.538776%2C%22y%22%3A146.7771%2C%22width%22%3A25.451144%2C%22height%22%3A9.292770000000019%2C%22text%22%3A%2212-18%22%7D%2C%7B%22x%22%3A547.66345%2C%22y%22%3A164.028%2C%22width%22%3A34.51604999999995%2C%22height%22%3A10.012830000000008%2C%22text%22%3A%228.2-11.2%22%7D%2C%7B%22x%22%3A140.54178%2C%22y%22%3A164.68597%2C%22width%22%3A26.49615%2C%22height%22%3A9.33001999999999%2C%22text%22%3A%2263-84%22%7D%2C%7B%22x%22%3A18.488222%2C%22y%22%3A164.69243%2C%22width%22%3A23.819437999999998%2C%22height%22%3A9.362850000000009%2C%22text%22%3A%226-10%22%7D%2C%7B%22x%22%3A178.79887%2C%22y%22%3A164.72571%2C%22width%22%3A33.587559999999996%2C%22height%22%3A9.886719999999997%2C%22text%22%3A%2211.1-13%22%7D%2C%7B%22x%22%3A383.80148%2C%22y%22%3A164.78802%2C%22width%22%3A32.38574999999997%2C%22height%22%3A9.14745000000002%2C%22text%22%3A%2212-12.1%22%7D%2C%7B%22x%22%3A223.47772%2C%22y%22%3A164.8244%2C%22width%22%3A25.859499999999997%2C%22height%22%3A9.568479999999994%2C%22text%22%3A%2250-69%22%7D%2C%7B%22x%22%3A59.288925%2C%22y%22%3A164.9958%2C%22width%22%3A25.467275000000008%2C%22height%22%3A8.90746999999999%2C%22text%22%3A%2279-83%22%7D%2C%7B%22x%22%3A99.19941%2C%22y%22%3A165.25041%2C%22width%22%3A26.027%2C%22height%22%3A9.07462000000001%2C%22text%22%3A%2267-79%22%7D%2C%7B%22x%22%3A261.14044%2C%22y%22%3A165.3267%2C%22width%22%3A33.00121999999999%2C%22height%22%3A8.988650000000007%2C%22text%22%3A%2211-13.3%22%7D%2C%7B%22x%22%3A341.80923%2C%22y%22%3A165.33429%2C%22width%22%3A36.16001%2C%22height%22%3A8.452269999999999%2C%22text%22%3A%222.1-4.4.4%22%7D%2C%7B%22x%22%3A512.52875%2C%22y%22%3A181.73412%2C%22width%22%3A24.36635000000001%2C%22height%22%3A10.446730000000002%2C%22text%22%3A%2212.12%22%7D%2C%7B%22x%22%3A146.92177%2C%22y%22%3A182.29652%2C%22width%22%3A12.693269999999984%2C%22height%22%3A10.229980000000012%2C%22text%22%3A%2285%22%7D%2C%7B%22x%22%3A472.5834%2C%22y%22%3A182.44109%2C%22width%22%3A17.23896000000002%2C%22height%22%3A9.576120000000003%2C%22text%22%3A%2279%22%7D%2C%7B%22x%22%3A596.93567%2C%22y%22%3A182.59251%2C%22width%22%3A19.589830000000006%2C%22height%22%3A8.9272%2C%22text%22%3A%2210.4%22%7D%2C%7B%22x%22%3A228.76355%2C%22y%22%3A182.61884%2C%22width%22%3A14.056719999999984%2C%22height%22%3A9.933879999999988%2C%22text%22%3A%2270%22%7D%2C%7B%22x%22%3A555.8511%2C%22y%22%3A182.65721%2C%22width%22%3A19.061739999999986%2C%22height%22%3A9.255009999999999%2C%22text%22%3A%2212.0%22%7D%2C%7B%22x%22%3A186.04143%2C%22y%22%3A182.68318%2C%22width%22%3A18.135940000000005%2C%22height%22%3A9.94287%2C%22text%22%3A%2213.1%22%7D%2C%7B%22x%22%3A352.40384%2C%22y%22%3A182.69997%2C%22width%22%3A12.455809999999985%2C%22height%22%3A9.302120000000002%2C%22text%22%3A%2281%22%7D%2C%7B%22x%22%3A64.820015%2C%22y%22%3A182.88295%2C%22width%22%3A12.965254999999999%2C%22height%22%3A9.103000000000009%2C%22text%22%3A%2284%22%7D%2C%7B%22x%22%3A393.08398%2C%22y%22%3A182.0446%2C%22width%22%3A56.37062000000003%2C%22height%22%3A10.40100000000001%2C%22text%22%3A%2246%2084%22%7D%2C%7B%22x%22%3A638.94855%2C%22y%22%3A182.98839%2C%22width%22%3A18.05045000000007%2C%22height%22%3A8.545899999999989%2C%22text%22%3A%227.12%22%7D%2C%7B%22x%22%3A106.33063%2C%22y%22%3A183.06238%2C%22width%22%3A12.434200000000004%2C%22height%22%3A8.740520000000004%2C%22text%22%3A%2280%22%7D%2C%7B%22x%22%3A267.59952%2C%22y%22%3A183.31566%2C%22width%22%3A19.71246000000002%2C%22height%22%3A9.21821%2C%22text%22%3A%2213.5%22%7D%2C%7B%22x%22%3A140.36201%2C%22y%22%3A200.1823%2C%22width%22%3A27.061759999999992%2C%22height%22%3A9.02600000000001%2C%22text%22%3A%2286-88%22%7D%2C%7B%22x%22%3A182.19917%2C%22y%22%3A201.22182%2C%22width%22%3A25.78797%2C%22height%22%3A8.104209999999995%2C%22text%22%3A%2214-TP%22%7D%2C%7B%22x%22%3A100.34609%2C%22y%22%3A201.20581%2C%22width%22%3A26.78241%2C%22height%22%3A7.883129999999994%2C%22text%22%3A%2281-82%22%7D%2C%7B%22x%22%3A269.28763%2C%22y%22%3A201.30327%2C%22width%22%3A17.88417000000004%2C%22height%22%3A8.018339999999995%2C%22text%22%3A%2214.0%22%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22uc6a329fc%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p><ul list=\"uc841e16f\"><li fid=\"u73c910af\" data-lake-id=\"uc0072ac8\" id=\"uc0072ac8\"><span data-lake-id=\"uea2a4c1d\" id=\"uea2a4c1d\">ESM 的解析过程</span></li></ul><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22vue%22%2C%22code%22%3A%22%3Ctemplate%3E%5Cn%20%20%3Cimg%20alt%3D'Vue%20logo'%20src%3D'.%2Fassets%2Flogo.png'%20%2F%3E%5Cn%20%20%3CHelloWorld%20msg%3D'Hello%20Vue%203.0%20%2B%20Vite'%20%2F%3E%5Cn%3C%2Ftemplate%3E%5Cn%5Cn%3Cscript%20script%3D'setup'%3E%5Cn%20%20import%20HelloWorld%20from%20'.%2Fcomponents%2FHelloWorld.vue'%5Cn%3C%2Fscript%3E%22%2C%22autoWrap%22%3Afalse%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22name%22%3A%22%E4%BB%A5%20vite%20%E5%88%9B%E5%BB%BA%E7%9A%84%E6%A8%A1%E7%89%88%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22One%20Dark%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22BgPQG%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"ua68aec6d\" id=\"ua68aec6d\"><span data-lake-id=\"u3f676a43\" id=\"u3f676a43\">当浏览器解析 </span><code data-lake-id=\"u6ea3b476\" id=\"u6ea3b476\"><span data-lake-id=\"u30797a35\" id=\"u30797a35\">import HelloWorld from './components/HelloWorld.vue'</span></code><span data-lake-id=\"u18c37310\" id=\"u18c37310\"> 时，会向当前于i域名发送一个请求获取对应的资源 (ESM 支持解析相对路径)。</span></p><p data-lake-id=\"ua892a23d\" id=\"ua892a23d\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F732231%2F1648048297903-a2968f11-ea42-4f2c-9b78-38165af6dddf.png%22%2C%22taskId%22%3A%22u56073992-4d54-4242-8f94-6264fabe417%22%2C%22clientId%22%3A%22u2d1aa443-6142-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A720%2C%22height%22%3A144%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A77196%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A720%2C%22originHeight%22%3A144%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22COOKIES%20HESPONSE%20PREVIEW%20HEAAERS%20INITIATOR%20GENERAL%20REQUEST%20URL%3AHTTP%3A%2F%2FLOCALHOST%3A3000%2FSRC%2FCOMPONENTS%2FHELLOWORLD.VUE%20REQUEST%20METHOD%3A%20GET%20STATUS%20CODE%3A304%20NOT%20MODIFIED%20REMOTE%20ADDRESS%3A%5B%3A%3A1%5D%3A3000%20REFERRER%20POLICY%3ANO-REFERRER-WHEN-DOWNGRADE%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A471.12656%2C%22y%22%3A-1.0078837%2C%22width%22%3A67.10458%2C%22height%22%3A10.5090537%2C%22text%22%3A%22COOKIES%22%7D%2C%7B%22x%22%3A222.07262%2C%22y%22%3A-0.49774107%2C%22width%22%3A82.44746%2C%22height%22%3A10.24486907%2C%22text%22%3A%22HESPONSE%22%7D%2C%7B%22x%22%3A140.56451%2C%22y%22%3A-0.41080475%2C%22width%22%3A65.02569%2C%22height%22%3A10.447035750000001%2C%22text%22%3A%22PREVIEW%22%7D%2C%7B%22x%22%3A58.347015%2C%22y%22%3A-0.6534659%2C%22width%22%3A67.28666%2C%22height%22%3A11.528350900000001%2C%22text%22%3A%22HEAAERS%22%7D%2C%7B%22x%22%3A321.1483%2C%22y%22%3A0.24819756%2C%22width%22%3A58.3535%2C%22height%22%3A9.54698944%2C%22text%22%3A%22INITIATOR%22%7D%2C%7B%22x%22%3A35.99875%2C%22y%22%3A20.579346%2C%22width%22%3A70.636466%2C%22height%22%3A17.473247%2C%22text%22%3A%22GENERAL%22%7D%2C%7B%22x%22%3A48.19214%2C%22y%22%3A42.36112%2C%22width%22%3A667.27753%2C%22height%22%3A19.7705%2C%22text%22%3A%22REQUEST%20URL%3AHTTP%3A%2F%2FLOCALHOST%3A3000%2FSRC%2FCOMPONENTS%2FHELLOWORLD.VUE%22%7D%2C%7B%22x%22%3A48.72049%2C%22y%22%3A62.46892%2C%22width%22%3A185.77377%2C%22height%22%3A21.178330000000003%2C%22text%22%3A%22REQUEST%20METHOD%3A%20GET%22%7D%2C%7B%22x%22%3A48.28128%2C%22y%22%3A82.83807%2C%22width%22%3A303.02988%2C%22height%22%3A19.944239999999994%2C%22text%22%3A%22STATUS%20CODE%3A304%20NOT%20MODIFIED%22%7D%2C%7B%22x%22%3A48.72945%2C%22y%22%3A104.25242%2C%22width%22%3A261.14799%2C%22height%22%3A17.30404%2C%22text%22%3A%22REMOTE%20ADDRESS%3A%5B%3A%3A1%5D%3A3000%22%7D%2C%7B%22x%22%3A48.72581%2C%22y%22%3A125.46557%2C%22width%22%3A414.86095%2C%22height%22%3A16.527460000000005%2C%22text%22%3A%22REFERRER%20POLICY%3ANO-REFERRER-WHEN-DOWNGRADE%22%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22uc8917cf7%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p><p data-lake-id=\"ub29acaed\" id=\"ub29acaed\"><span data-lake-id=\"u0fa4c718\" id=\"u0fa4c718\">浏览器下载对应的资源，然后解析成模块记录。接下来会进行实例化，为模块分配内存，然后按照导入、导出语句建立模块和内存的映射关系。最后，运行上述代码，把内存空间填充为真实的值。</span></p><h2 data-lake-id=\"KyarL\" id=\"KyarL\"><span data-lake-id=\"u1f37dc39\" id=\"u1f37dc39\">esbuild</span></h2><p data-lake-id=\"uc15a6e48\" id=\"uc15a6e48\"><span data-lake-id=\"u38984d5e\" id=\"u38984d5e\">vite 采用 esbuild 进行打包，esbuild 是一个全新的 js 打包工具，支持如 babel、压缩等功能。其底层使用了 go 语言实现，整体打包会快 10 ～ 100 倍。同时大量使用了并行操作，可以充分利用 cpu 资源。</span></p><ul list=\"udeb157c1\"><li fid=\"u0cbb3b69\" data-lake-id=\"ub122de0f\" id=\"ub122de0f\"><span data-lake-id=\"u83802900\" id=\"u83802900\">esbuild 对比 其他打包工具如下：</span></li></ul><p data-lake-id=\"ued5cbfce\" id=\"ued5cbfce\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F732231%2F1648048411757-695df03b-4d10-4d26-a40f-2d118244cf32.png%22%2C%22taskId%22%3A%22ud14dd21f-c0eb-4b33-acdd-3a8707ae381%22%2C%22clientId%22%3A%22u2d1aa443-6142-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A720%2C%22height%22%3A289%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A120172%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A720%2C%22originHeight%22%3A289%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22THIS%20BENCHMARK%20APPROXIMATES%20A%20LARGE%20JAVASCRIPT%20CODEBASE%20BY%20DUPLICATING%20THE%20THREEJS%20LIBRARY%201O%20TIMES%20A%20BULIDING%20A%20SINGLE%20BUNDLE%20FROM%20SCRATCH%2CWITHOUT%20ANY%20CACHES.THE%20BENCHMARK%20CAN%20BE%20RUN%20WITH%20MAKE%20BENCH-THR%20OUTPUT%20SIZE%20TIME%20ABSOLUTE%20SPEED%20BUNDLER%20RELATIVE%20SLOWDOWN%201520.7%20KLOC%2FS%200.36S%205.82MB%20ESBUILD%201X%201.25S%20438.0%20KLOC%2FS%20ESBUILD(1%20THREAD)%205.82MB%204X%2036.06S%205.80MB%2015.2%20KLOC%2FS%20100X%20ROLLUP%20%2BTERSER%2012.2%20KLOC%2FS%2044.74S%205.97MB%20WEBPACK%20124X%209.2KLOC%2FS%2059.52S%20165X%206.34MB%20FUSE-BOX%40NEXT%20121.18S%204.5KLOC%2FS%20337X%205.89MB%20PARCEL%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A5.738713%2C%22y%22%3A0.7206624%2C%22width%22%3A677.745387%2C%22height%22%3A16.074921600000003%2C%22text%22%3A%22THIS%20BENCHMARK%20APPROXIMATES%20A%20LARGE%20JAVASCRIPT%20CODEBASE%20BY%20DUPLICATING%20THE%20THREEJS%20LIBRARY%201O%20TIMES%20A%22%7D%2C%7B%22x%22%3A7.9878335%2C%22y%22%3A22.187376%2C%22width%22%3A702.0370665%2C%22height%22%3A15.685443999999997%2C%22text%22%3A%22BULIDING%20A%20SINGLE%20BUNDLE%20FROM%20SCRATCH%2CWITHOUT%20ANY%20CACHES.THE%20BENCHMARK%20CAN%20BE%20RUN%20WITH%20MAKE%20BENCH-THR%22%7D%2C%7B%22x%22%3A499.4778%2C%22y%22%3A65.19211%2C%22width%22%3A79.65105000000005%2C%22height%22%3A14.070369999999997%2C%22text%22%3A%22OUTPUT%20SIZE%22%7D%2C%7B%22x%22%3A167.82825%2C%22y%22%3A65.5677%2C%22width%22%3A34.1396%2C%22height%22%3A13.071659999999994%2C%22text%22%3A%22TIME%22%7D%2C%7B%22x%22%3A371.36426%2C%22y%22%3A65.97315%2C%22width%22%3A106.96776999999997%2C%22height%22%3A13.504289999999997%2C%22text%22%3A%22ABSOLUTE%20SPEED%22%7D%2C%7B%22x%22%3A17.57245%2C%22y%22%3A65.99073%2C%22width%22%3A53.02203999999999%2C%22height%22%3A12.78331%2C%22text%22%3A%22BUNDLER%22%7D%2C%7B%22x%22%3A223.9962%2C%22y%22%3A65.36492%2C%22width%22%3A125.77967999999998%2C%22height%22%3A14.185919999999996%2C%22text%22%3A%22RELATIVE%20SLOWDOWN%22%7D%2C%7B%22x%22%3A391.79575%2C%22y%22%3A98.07287%2C%22width%22%3A86.01992000000001%2C%22height%22%3A13.528540000000007%2C%22text%22%3A%221520.7%20KLOC%2FS%22%7D%2C%7B%22x%22%3A164.2207%2C%22y%22%3A98.29364%2C%22width%22%3A37.55355%2C%22height%22%3A13.582480000000004%2C%22text%22%3A%220.36S%22%7D%2C%7B%22x%22%3A528.90955%2C%22y%22%3A98.713356%2C%22width%22%3A49.08275000000003%2C%22height%22%3A12.635947999999999%2C%22text%22%3A%225.82MB%22%7D%2C%7B%22x%22%3A16.877083%2C%22y%22%3A98.70193%2C%22width%22%3A48.135457%2C%22height%22%3A12.862279999999998%2C%22text%22%3A%22ESBUILD%22%7D%2C%7B%22x%22%3A335.03226%2C%22y%22%3A98.983376%2C%22width%22%3A15.010980000000018%2C%22height%22%3A12.768553999999995%2C%22text%22%3A%221X%22%7D%2C%7B%22x%22%3A167.07079%2C%22y%22%3A130.69252%2C%22width%22%3A34.52484000000001%2C%22height%22%3A13.095949999999988%2C%22text%22%3A%221.25S%22%7D%2C%7B%22x%22%3A397.90457%2C%22y%22%3A130.93748%2C%22width%22%3A79.62079%2C%22height%22%3A14.318849999999998%2C%22text%22%3A%22438.0%20KLOC%2FS%22%7D%2C%7B%22x%22%3A16.54631%2C%22y%22%3A130.99739%2C%22width%22%3A114.0959%2C%22height%22%3A13.974150000000009%2C%22text%22%3A%22ESBUILD(1%20THREAD)%22%7D%2C%7B%22x%22%3A528.58105%2C%22y%22%3A131.03496%2C%22width%22%3A50.325849999999946%2C%22height%22%3A13.060359999999974%2C%22text%22%3A%225.82MB%22%7D%2C%7B%22x%22%3A331.4597%2C%22y%22%3A131.58205%2C%22width%22%3A20.174800000000005%2C%22height%22%3A12.987709999999993%2C%22text%22%3A%224X%22%7D%2C%7B%22x%22%3A155.47597%2C%22y%22%3A163.6769%2C%22width%22%3A46.147490000000005%2C%22height%22%3A13.442840000000018%2C%22text%22%3A%2236.06S%22%7D%2C%7B%22x%22%3A528.3826%2C%22y%22%3A163.83882%2C%22width%22%3A49.99454000000003%2C%22height%22%3A12.546999999999997%2C%22text%22%3A%225.80MB%22%7D%2C%7B%22x%22%3A408.1132%2C%22y%22%3A163.93791%2C%22width%22%3A69.95256999999998%2C%22height%22%3A14.100860000000011%2C%22text%22%3A%2215.2%20KLOC%2FS%22%7D%2C%7B%22x%22%3A317.91348%2C%22y%22%3A164.00305%2C%22width%22%3A32.26816000000002%2C%22height%22%3A12.858659999999986%2C%22text%22%3A%22100X%22%7D%2C%7B%22x%22%3A16.645403%2C%22y%22%3A164.3171%2C%22width%22%3A91.852307%2C%22height%22%3A14.354329999999976%2C%22text%22%3A%22ROLLUP%20%2BTERSER%22%7D%2C%7B%22x%22%3A407.95337%2C%22y%22%3A195.68567%2C%22width%22%3A69.53516000000002%2C%22height%22%3A15.106490000000008%2C%22text%22%3A%2212.2%20KLOC%2FS%22%7D%2C%7B%22x%22%3A156.39372%2C%22y%22%3A196.30206%2C%22width%22%3A45.003659999999996%2C%22height%22%3A13.473389999999995%2C%22text%22%3A%2244.74S%22%7D%2C%7B%22x%22%3A529.383%2C%22y%22%3A196.40099%2C%22width%22%3A49.5009%2C%22height%22%3A13.666619999999995%2C%22text%22%3A%225.97MB%22%7D%2C%7B%22x%22%3A15.723846%2C%22y%22%3A196.39781%2C%22width%22%3A60.510624%2C%22height%22%3A14.274130000000014%2C%22text%22%3A%22WEBPACK%22%7D%2C%7B%22x%22%3A317.94107%2C%22y%22%3A196.72319%2C%22width%22%3A32.46996999999999%2C%22height%22%3A13.301470000000023%2C%22text%22%3A%22124X%22%7D%2C%7B%22x%22%3A415.02356%2C%22y%22%3A228.74394%2C%22width%22%3A62.1857%2C%22height%22%3A14.081580000000002%2C%22text%22%3A%229.2KLOC%2FS%22%7D%2C%7B%22x%22%3A155.59952%2C%22y%22%3A229.33942%2C%22width%22%3A44.79532999999998%2C%22height%22%3A12.934200000000004%2C%22text%22%3A%2259.52S%22%7D%2C%7B%22x%22%3A316.6416%2C%22y%22%3A229.70189%2C%22width%22%3A32.34946000000002%2C%22height%22%3A12.412260000000003%2C%22text%22%3A%22165X%22%7D%2C%7B%22x%22%3A528.14716%2C%22y%22%3A229.80656%2C%22width%22%3A49.92863999999997%2C%22height%22%3A12.328159999999997%2C%22text%22%3A%226.34MB%22%7D%2C%7B%22x%22%3A17.684378%2C%22y%22%3A229.95207%2C%22width%22%3A99.291082%2C%22height%22%3A12.082160000000016%2C%22text%22%3A%22FUSE-BOX%40NEXT%22%7D%2C%7B%22x%22%3A153.641%2C%22y%22%3A261.96222%2C%22width%22%3A48.47240000000002%2C%22height%22%3A12.706380000000024%2C%22text%22%3A%22121.18S%22%7D%2C%7B%22x%22%3A415.3588%2C%22y%22%3A262.30807%2C%22width%22%3A61.945550000000026%2C%22height%22%3A12.41534999999999%2C%22text%22%3A%224.5KLOC%2FS%22%7D%2C%7B%22x%22%3A315.2774%2C%22y%22%3A262.35287%2C%22width%22%3A34.878120000000024%2C%22height%22%3A13.278750000000002%2C%22text%22%3A%22337X%22%7D%2C%7B%22x%22%3A528.0618%2C%22y%22%3A262.7037%2C%22width%22%3A50.6572000000001%2C%22height%22%3A12.027699999999982%2C%22text%22%3A%225.89MB%22%7D%2C%7B%22x%22%3A16.70389%2C%22y%22%3A264.0563%2C%22width%22%3A41.938974%2C%22height%22%3A12.61039999999997%2C%22text%22%3A%22PARCEL%22%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22udf3a44f1%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p><ul list=\"uefb7ff1e\"><li fid=\"u5692857d\" data-lake-id=\"udcc7f9bb\" id=\"udcc7f9bb\"><span data-lake-id=\"u89c116a2\" id=\"u89c116a2\">esbuild 支持以下的功能：</span></li></ul><ul list=\"uefb7ff1e\" data-lake-indent=\"1\"><li fid=\"u5692857d\" data-lake-id=\"u48a5081d\" id=\"u48a5081d\"><span data-lake-id=\"u0a32b1b2\" id=\"u0a32b1b2\">加载器</span></li><li fid=\"u5692857d\" data-lake-id=\"uee4ccc38\" id=\"uee4ccc38\"><span data-lake-id=\"ud0f1dda9\" id=\"ud0f1dda9\">压缩</span></li><li fid=\"u5692857d\" data-lake-id=\"u33bc0897\" id=\"u33bc0897\"><span data-lake-id=\"ue147f5b5\" id=\"ue147f5b5\">打包</span></li><li fid=\"u5692857d\" data-lake-id=\"u2b3f450c\" id=\"u2b3f450c\"><span data-lake-id=\"u5ef063df\" id=\"u5ef063df\">tree-shaking</span></li><li fid=\"u5692857d\" data-lake-id=\"ue6720b38\" id=\"ue6720b38\"><span data-lake-id=\"u49f7720a\" id=\"u49f7720a\">source map 生成</span></li></ul><blockquote data-lake-id=\"udb5711cf\" id=\"udb5711cf\" class=\"lake-alert lake-alert-info\"><p data-lake-id=\"u3c532b99\" id=\"u3c532b99\"><span data-lake-id=\"u8b5ecda2\" id=\"u8b5ecda2\">esbuild 总共提供了四个函数：transform、build、buildSync、Service</span></p></blockquote><h2 data-lake-id=\"GSb0p\" id=\"GSb0p\"><span data-lake-id=\"u4f4faab8\" id=\"u4f4faab8\">rollup</span></h2><p data-lake-id=\"uc736da0b\" id=\"uc736da0b\"><span data-lake-id=\"ue4a0688e\" id=\"ue4a0688e\">在生产环境下，vite 使用 rollup 来进行打包</span></p><p data-lake-id=\"u4435d33e\" id=\"u4435d33e\"><span data-lake-id=\"ufb22b64e\" id=\"ufb22b64e\">​</span><br></p><p data-lake-id=\"u79db7e19\" id=\"u79db7e19\"><span data-lake-id=\"u0f132190\" id=\"u0f132190\">rollup 是基于 ESM 的 javaScript 打包工具，相比于 webpack，他总能打出更小、更快的包。因为 rollup 基于 ESM 模块，比 webpack 和 Browserify 使用的 CommonJS 模块机制更高效。rollup 的亮点在于同一个地方，一次性加载。能针对源码进行 tree shaking，以及 scope hoisting 以减小输出文件大小，提升运行性能。</span></p><p data-lake-id=\"u37026913\" id=\"u37026913\"><br></p><p data-lake-id=\"u04f72bc5\" id=\"u04f72bc5\"><span data-lake-id=\"uc343704c\" id=\"uc343704c\">rollup 分为 build(构建) 阶段和 output generate(输出生成) 阶段。主要过程如下：</span></p><ol list=\"u50e1d3ae\"><li fid=\"u01e9273c\" data-lake-id=\"u7936c6c9\" id=\"u7936c6c9\"><span data-lake-id=\"u53f62278\" id=\"u53f62278\">获取入口文件的内容，包装成 module，生成 ast</span></li><li fid=\"u01e9273c\" data-lake-id=\"ud7bb6ba9\" id=\"ud7bb6ba9\"><span data-lake-id=\"u6ca98b46\" id=\"u6ca98b46\">对入口文件 ast 进行依赖解析</span></li><li fid=\"u01e9273c\" data-lake-id=\"ue39d58de\" id=\"ue39d58de\"><span data-lake-id=\"u24d82036\" id=\"u24d82036\">生成最终代码</span></li><li fid=\"u01e9273c\" data-lake-id=\"ua609bf67\" id=\"ua609bf67\"><span data-lake-id=\"u6d071dc5\" id=\"u6d071dc5\">写入目标文件</span></li></ol>",
  "body_draft_lake": "",
  "public": 0,
  "status": 1,
  "view_status": 0,
  "read_status": 1,
  "likes_count": 0,
  "comments_count": 0,
  "content_updated_at": "2022-04-04T11:33:56.000Z",
  "deleted_at": null,
  "created_at": "2022-04-04T11:33:56.000Z",
  "updated_at": "2022-05-10T15:12:32.000Z",
  "published_at": "2022-04-04T11:33:56.000Z",
  "first_published_at": "2022-04-04T11:33:55.824Z",
  "word_count": 656,
  "cover": "https://cdn.nlark.com/yuque/0/2022/png/732231/1648048044646-2af9cb9a-e215-4d1b-b63f-b40ea00780e7.png",
  "description": "ESMESM 是 es6 出现后，浏览器支持的一种模块化方案，允许在浏览器实现模块化。与 CommonJS、AMD 不同，ESM 对外借口只是一种静态定义，为编译时记载，遇到模块加载命令 import，就会生成一个只读引用。等脚本真正执行时，再根据这个只读引用，到被加载的那个模块内取值。由于 ...",
  "custom_description": null,
  "hits": 0,
  "_serializer": "v2.doc_detail"
}