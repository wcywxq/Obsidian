{
  "id": 72212095,
  "slug": "yuqbh0",
  "title": "tcp 三次握手四次挥手",
  "book_id": 26225124,
  "book": {
    "id": 26225124,
    "type": "Book",
    "slug": "mxunh7",
    "name": "八股文 eight-part essay writing",
    "user_id": 732231,
    "description": "前端八股文",
    "creator_id": 732231,
    "public": 0,
    "items_count": 239,
    "likes_count": 0,
    "watches_count": 1,
    "content_updated_at": "2023-11-11T18:15:57.023Z",
    "updated_at": "2023-11-11T18:15:57.000Z",
    "created_at": "2022-04-04T11:31:45.000Z",
    "namespace": "wcywxq/mxunh7",
    "user": {
      "id": 732231,
      "type": "User",
      "login": "wcywxq",
      "name": "magic",
      "description": null,
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/732231/1606968271774-avatar/886ad88b-d2cc-4c9e-a674-f70eb51a679c.png",
      "books_count": 18,
      "public_books_count": 0,
      "followers_count": 0,
      "following_count": 0,
      "created_at": "2020-01-08T14:21:31.000Z",
      "updated_at": "2023-11-13T09:32:35.000Z",
      "_serializer": "v2.user"
    },
    "_serializer": "v2.book"
  },
  "user_id": 732231,
  "creator": {
    "id": 732231,
    "type": "User",
    "login": "wcywxq",
    "name": "magic",
    "description": null,
    "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/732231/1606968271774-avatar/886ad88b-d2cc-4c9e-a674-f70eb51a679c.png",
    "books_count": 18,
    "public_books_count": 0,
    "followers_count": 0,
    "following_count": 0,
    "created_at": "2020-01-08T14:21:31.000Z",
    "updated_at": "2023-11-13T09:32:35.000Z",
    "_serializer": "v2.user"
  },
  "format": "lake",
  "body": "<a name=\"ZC4DT\"></a>\n## 建立连接\n- http 和 https 都需要在建立连接的基础上来进行数据传输\n- 当客户在浏览器输入网址并按下回车，浏览器会在**浏览器 dns 缓存**、**本地 dns 缓存** 以及 **host** 中寻找对应记录，如果没有获取到则会请求 **dns** 服务来获取对应 **ip**\n- 获取 **ip** 后，**tcp** 连接会进行三次握手建立连接\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/732231/1647345588824-8b534273-6752-4b0f-b9b5-b07c33cb5495.png#clientId=ubb30476d-5b4a-4&from=paste&height=497&id=ub25d989c&originHeight=497&originWidth=500&originalType=binary&ratio=1&size=31706&status=done&style=none&taskId=ufa6b182c-983c-4f08-a7ea-9ddb72879e4&width=500)\n<a name=\"KVJDH\"></a>\n## 三次握手\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/732231/1647677397909-c6ff04d4-8c1e-44a1-b6a7-3a602618cad5.png#clientId=u4cf63390-cceb-4&from=paste&height=780&id=u0b0117c5&originHeight=780&originWidth=1164&originalType=binary&ratio=1&size=207135&status=done&style=none&taskId=ub6164320-d9a6-4ac3-97c4-4b9b38834bf&width=1164)\n:::tips\n作用：确认客户端和服务端的接收与发送能力是否正常\n:::\n\n1. 建立连接时，客户端发送 syn 包到服务端，并进入 syn_send 状态\n2. 服务端收到 syn 包后，向客户端发送 syn + ack 包，服务器进入 syn_rcvd 状态\n3. 客户端收到服务端的 syn + ack 包后，向服务器发送 ack 确认包，发送完后，两边同时进入 establish 状态\n<a name=\"UOsVp\"></a>\n### 总结\n\n1. 第一次握手：客服端发送网络包，服务端收到了。这样服务端可以得到结论：客户端的发送能力、服务端的接收能力是正常的\n2. 第二次握手：服务端发包，客户端收到了。这样客户端可以得到结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的。不过此时服务器并不能确认客户端的接收能力是否正常\n3. 第三次握手：客户端发包，服务端收到了。这样服务端可以得到结论：客户端的接收、发送能力正常，服务器自己的发送、接收能力也正常\n<a name=\"L82XP\"></a>\n## 四次挥手\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/732231/1647677428236-584045d3-e1f2-42e7-8aad-d84be434c416.png#clientId=u4cf63390-cceb-4&from=paste&height=1080&id=u9b4b8874&originHeight=1080&originWidth=1526&originalType=binary&ratio=1&size=493723&status=done&style=none&taskId=u484c4b55-1984-43d0-aa81-fccbe49d532&width=1526)\n\n1. tcp 向服务端发送 fin 包，用来关闭客户端到服务端之间的传输\n2. 服务端收到 fin 包，返回一个 ack 包\n3. 服务器关闭客户端的连接，发送一个 fin 包给客户端\n4. 客户端发送 ack 报文进行确认\n<a name=\"xJi4s\"></a>\n### 总结\n刚开始客户端和服务端都处于连接状态，然后某一方发起关闭请求，加入客户端发起关闭请求\n\n1. 第一次挥手：客户端发送一个 FIN 报文，报文中会只定义个序列号。此时客户端处于 FIN_WAIT1 状态\n2. 第二次握手：服务端收到 FIN 之后，会发送 ACK 报文，且把客户端的序列号值 +1 作为 ACK 报文的序列号值，表明已经收到客户端的报文了，此时服务端处于 CLOSE_WAIT 状态\n3. 第三次挥手：如果服务端也想断开连接了，和客户端的第一次挥手一样，发给 FIN 报文，且指定一个序列号。此时服务端处于 LAST_ACK 状态\n4. 第四次挥手：客户端收到 FIN 之后，一样发送一个 ACK 报文作为应答，且把服务端的序列号值 +1 作为自己 ACK 报文的序列号值，此时客户端处于 TIME_WAIT 状态。需要过一段时间，以确保服务端收到自己的 ACK 报文之后才会进入 CLOSE 状态\n",
  "body_draft": "",
  "body_html": "<!doctype html><h2 id=\"ZC4DT\"><span>建立连接</span></h2><ul><li><span>http 和 https 都需要在建立连接的基础上来进行数据传输</span></li><li><span>当客户在浏览器输入网址并按下回车，浏览器会在</span><strong><span>浏览器 dns 缓存</span></strong><span>、</span><strong><span>本地 dns 缓存</span></strong><span> 以及 </span><strong><span>host</span></strong><span> 中寻找对应记录，如果没有获取到则会请求 </span><strong><span>dns</span></strong><span> 服务来获取对应 </span><strong><span>ip</span></strong></li><li><span>获取 </span><strong><span>ip</span></strong><span> 后，</span><strong><span>tcp</span></strong><span> 连接会进行三次握手建立连接</span></li></ul><p data-lake-id=\"u48ea19e8\"><img alt=\"image.png\" src=\"https://cdn.nlark.com/yuque/0/2022/png/732231/1647345588824-8b534273-6752-4b0f-b9b5-b07c33cb5495.png#clientId=ubb30476d-5b4a-4&amp;from=paste&amp;height=497&amp;id=ub25d989c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=497&amp;originWidth=500&amp;originalType=binary&amp;ratio=1&amp;size=31706&amp;status=done&amp;style=none&amp;taskId=ufa6b182c-983c-4f08-a7ea-9ddb72879e4&amp;width=500\" style=\"max-width: 600px; width: 500px;\" /></p><h2 id=\"KVJDH\"><span>三次握手</span></h2><p data-lake-id=\"u6759624a\"><img alt=\"image.png\" src=\"https://cdn.nlark.com/yuque/0/2022/png/732231/1647677397909-c6ff04d4-8c1e-44a1-b6a7-3a602618cad5.png#clientId=u4cf63390-cceb-4&amp;from=paste&amp;height=780&amp;id=u0b0117c5&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=780&amp;originWidth=1164&amp;originalType=binary&amp;ratio=1&amp;size=207135&amp;status=done&amp;style=none&amp;taskId=ub6164320-d9a6-4ac3-97c4-4b9b38834bf&amp;width=1164\" style=\"max-width: 600px; width: 1164px;\" /></p><blockquote class=\"lake-alert lake-alert-tips\"><p data-lake-id=\"u34b4f2f6\"><span>作用：确认客户端和服务端的接收与发送能力是否正常</span></p></blockquote><ol><li><span>建立连接时，客户端发送 syn 包到服务端，并进入 syn_send 状态</span></li><li><span>服务端收到 syn 包后，向客户端发送 syn + ack 包，服务器进入 syn_rcvd 状态</span></li><li><span>客户端收到服务端的 syn + ack 包后，向服务器发送 ack 确认包，发送完后，两边同时进入 establish 状态</span></li></ol><h3 id=\"UOsVp\"><span>总结</span></h3><ol><li><span>第一次握手：客服端发送网络包，服务端收到了。这样服务端可以得到结论：客户端的发送能力、服务端的接收能力是正常的</span></li><li><span>第二次握手：服务端发包，客户端收到了。这样客户端可以得到结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的。不过此时服务器并不能确认客户端的接收能力是否正常</span></li><li><span>第三次握手：客户端发包，服务端收到了。这样服务端可以得到结论：客户端的接收、发送能力正常，服务器自己的发送、接收能力也正常</span></li></ol><h2 id=\"L82XP\"><span>四次挥手</span></h2><p data-lake-id=\"u195f492e\"><img alt=\"image.png\" src=\"https://cdn.nlark.com/yuque/0/2022/png/732231/1647677428236-584045d3-e1f2-42e7-8aad-d84be434c416.png#clientId=u4cf63390-cceb-4&amp;from=paste&amp;height=1080&amp;id=u9b4b8874&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1080&amp;originWidth=1526&amp;originalType=binary&amp;ratio=1&amp;size=493723&amp;status=done&amp;style=none&amp;taskId=u484c4b55-1984-43d0-aa81-fccbe49d532&amp;width=1526\" style=\"max-width: 600px; width: 1526px;\" /></p><ol><li><span>tcp 向服务端发送 fin 包，用来关闭客户端到服务端之间的传输</span></li><li><span>服务端收到 fin 包，返回一个 ack 包</span></li><li><span>服务器关闭客户端的连接，发送一个 fin 包给客户端</span></li><li><span>客户端发送 ack 报文进行确认</span></li></ol><h3 id=\"xJi4s\"><span>总结</span></h3><p data-lake-id=\"u009616ad\" style=\"text-indent: 2em;\"><span>刚开始客户端和服务端都处于连接状态，然后某一方发起关闭请求，加入客户端发起关闭请求</span></p><ol><li><span>第一次挥手：客户端发送一个 FIN 报文，报文中会只定义个序列号。此时客户端处于 FIN_WAIT1 状态</span></li><li><span>第二次握手：服务端收到 FIN 之后，会发送 ACK 报文，且把客户端的序列号值 +1 作为 ACK 报文的序列号值，表明已经收到客户端的报文了，此时服务端处于 CLOSE_WAIT 状态</span></li><li><span>第三次挥手：如果服务端也想断开连接了，和客户端的第一次挥手一样，发给 FIN 报文，且指定一个序列号。此时服务端处于 LAST_ACK 状态</span></li><li><span>第四次挥手：客户端收到 FIN 之后，一样发送一个 ACK 报文作为应答，且把服务端的序列号值 +1 作为自己 ACK 报文的序列号值，此时客户端处于 TIME_WAIT 状态。需要过一段时间，以确保服务端收到自己的 ACK 报文之后才会进入 CLOSE 状态</span></li></ol>",
  "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"adapt\" /><h2 data-lake-id=\"ZC4DT\" id=\"ZC4DT\"><span data-lake-id=\"u91047738\" id=\"u91047738\">建立连接</span></h2><ul list=\"udabe063b\"><li fid=\"u808875b9\" data-lake-id=\"ua4d64df5\" id=\"ua4d64df5\"><span data-lake-id=\"u0da4c3bd\" id=\"u0da4c3bd\">http 和 https 都需要在建立连接的基础上来进行数据传输</span></li><li fid=\"u808875b9\" data-lake-id=\"u57e63777\" id=\"u57e63777\"><span data-lake-id=\"u12d39867\" id=\"u12d39867\">当客户在浏览器输入网址并按下回车，浏览器会在</span><strong><span data-lake-id=\"u40b85dc7\" id=\"u40b85dc7\">浏览器 dns 缓存</span></strong><span data-lake-id=\"u43c37ce9\" id=\"u43c37ce9\">、</span><strong><span data-lake-id=\"u18e6e16f\" id=\"u18e6e16f\">本地 dns 缓存</span></strong><span data-lake-id=\"u3676c3a6\" id=\"u3676c3a6\"> 以及 </span><strong><span data-lake-id=\"u60f2551d\" id=\"u60f2551d\">host</span></strong><span data-lake-id=\"ua8e1c682\" id=\"ua8e1c682\"> 中寻找对应记录，如果没有获取到则会请求 </span><strong><span data-lake-id=\"ue4bed585\" id=\"ue4bed585\">dns</span></strong><span data-lake-id=\"u27f0a57c\" id=\"u27f0a57c\"> 服务来获取对应 </span><strong><span data-lake-id=\"uc962febb\" id=\"uc962febb\">ip</span></strong></li><li fid=\"u808875b9\" data-lake-id=\"ua44962d0\" id=\"ua44962d0\"><span data-lake-id=\"u9e7e4392\" id=\"u9e7e4392\">获取 </span><strong><span data-lake-id=\"u8b4c4cc6\" id=\"u8b4c4cc6\">ip</span></strong><span data-lake-id=\"u3f32c909\" id=\"u3f32c909\"> 后，</span><strong><span data-lake-id=\"u13069228\" id=\"u13069228\">tcp</span></strong><span data-lake-id=\"u47a8f82d\" id=\"u47a8f82d\"> 连接会进行三次握手建立连接</span></li></ul><p data-lake-id=\"u48ea19e8\" id=\"u48ea19e8\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F732231%2F1647345588824-8b534273-6752-4b0f-b9b5-b07c33cb5495.png%22%2C%22taskId%22%3A%22ufa6b182c-983c-4f08-a7ea-9ddb72879e4%22%2C%22clientId%22%3A%22ubb30476d-5b4a-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A500%2C%22height%22%3A497%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A31706%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A500%2C%22originHeight%22%3A497%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%E6%9C%8D%E5%8A%A1%E5%99%A8%20%E5%AE%A2%E6%88%B7%20(%E8%A2%AB%E5%8A%A8%E6%89%93%E5%BC%80)%20LISTEN%20%E4%B8%BB%E5%8A%A8%E6%89%93%E5%BC%80SYN_SENT%20SYN%5D%20SYN_RCVD%20SYN%20K%2CACK%20J%2B1%20ESTABLISHED%20ACK%20K%2B1%20ESTABLISHED%20%E4%B8%BB%E5%8A%A8%E5%85%B3%E9%97%ADFIN_WAIT_1%20FINM%20(%E8%A2%AB%E5%8A%A8%20CLOSE%20WAIT%20%E5%85%B3%E9%97%AD)%20ACK%20M%2B1%20FIN%20WAIT%202%20LAST%20ACK%20FINN%20TIME%20WAIT%20ACK%20N%2B1%20CLOSED%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A331.8967%2C%22y%22%3A20.462961%2C%22width%22%3A45.908019999999965%2C%22height%22%3A15.963583%2C%22text%22%3A%22%E6%9C%8D%E5%8A%A1%E5%99%A8%22%7D%2C%7B%22x%22%3A138.78677%2C%22y%22%3A21.40136%2C%22width%22%3A29.807630000000017%2C%22height%22%3A14.257229999999996%2C%22text%22%3A%22%E5%AE%A2%E6%88%B7%22%7D%2C%7B%22x%22%3A409.78125%2C%22y%22%3A65.550705%2C%22width%22%3A72.17441000000002%2C%22height%22%3A18.47008500000001%2C%22text%22%3A%22(%E8%A2%AB%E5%8A%A8%E6%89%93%E5%BC%80)%22%7D%2C%7B%22x%22%3A361.96143%2C%22y%22%3A67.62765%2C%22width%22%3A42.68270000000001%2C%22height%22%3A11.909800000000004%2C%22text%22%3A%22LISTEN%22%7D%2C%7B%22x%22%3A20.586046%2C%22y%22%3A87.489136%2C%22width%22%3A127.492754%2C%22height%22%3A16.262328999999994%2C%22text%22%3A%22%E4%B8%BB%E5%8A%A8%E6%89%93%E5%BC%80SYN_SENT%22%7D%2C%7B%22x%22%3A238.80977%2C%22y%22%3A92.19833%2C%22width%22%3A32.877129999999994%2C%22height%22%3A12.623683999999997%2C%22text%22%3A%22SYN%5D%22%7D%2C%7B%22x%22%3A361.49%2C%22y%22%3A108.22294%2C%22width%22%3A66.0428%2C%22height%22%3A13.691450000000003%2C%22text%22%3A%22SYN_RCVD%22%7D%2C%7B%22x%22%3A213.97643%2C%22y%22%3A139.93065%2C%22width%22%3A80.39915000000002%2C%22height%22%3A20.876649999999984%2C%22text%22%3A%22SYN%20K%2CACK%20J%2B1%22%7D%2C%7B%22x%22%3A69.83423%2C%22y%22%3A162.88104%2C%22width%22%3A77.50793%2C%22height%22%3A10.81461999999999%2C%22text%22%3A%22ESTABLISHED%22%7D%2C%7B%22x%22%3A234.45709%2C%22y%22%3A196.31111%2C%22width%22%3A42.38571000000002%2C%22height%22%3A11.57029%2C%22text%22%3A%22ACK%20K%2B1%22%7D%2C%7B%22x%22%3A362.55127%2C%22y%22%3A211.91899%2C%22width%22%3A80.50317000000001%2C%22height%22%3A12.380689999999987%2C%22text%22%3A%22ESTABLISHED%22%7D%2C%7B%22x%22%3A14.804825%2C%22y%22%3A284.58963%2C%22width%22%3A133.32969500000002%2C%22height%22%3A17.27276999999998%2C%22text%22%3A%22%E4%B8%BB%E5%8A%A8%E5%85%B3%E9%97%ADFIN_WAIT_1%22%7D%2C%7B%22x%22%3A237.48798%2C%22y%22%3A287.08127%2C%22width%22%3A37.960199999999986%2C%22height%22%3A14.450870000000009%2C%22text%22%3A%22FINM%22%7D%2C%7B%22x%22%3A445.4568%2C%22y%22%3A297.91013%2C%22width%22%3A34.52235999999999%2C%22height%22%3A17.54409000000004%2C%22text%22%3A%22(%E8%A2%AB%E5%8A%A8%22%7D%2C%7B%22x%22%3A362.603%2C%22y%22%3A303.2532%2C%22width%22%3A75.60805999999997%2C%22height%22%3A14.053100000000029%2C%22text%22%3A%22CLOSE%20WAIT%22%7D%2C%7B%22x%22%3A444.00122%2C%22y%22%3A322.5955%2C%22width%22%3A35.7106%2C%22height%22%3A16.237259999999992%2C%22text%22%3A%22%E5%85%B3%E9%97%AD)%22%7D%2C%7B%22x%22%3A231.14977%2C%22y%22%3A338.41013%2C%22width%22%3A47.23973000000001%2C%22height%22%3A16.665099999999995%2C%22text%22%3A%22ACK%20M%2B1%22%7D%2C%7B%22x%22%3A80.37919%2C%22y%22%3A357.84473%2C%22width%22%3A68.96729000000002%2C%22height%22%3A12.813229999999976%2C%22text%22%3A%22FIN%20WAIT%202%22%7D%2C%7B%22x%22%3A361.78635%2C%22y%22%3A365.88965%2C%22width%22%3A64.65029999999996%2C%22height%22%3A14.435389999999984%2C%22text%22%3A%22LAST%20ACK%22%7D%2C%7B%22x%22%3A237.65446%2C%22y%22%3A369.0673%2C%22width%22%3A34.505059999999986%2C%22height%22%3A14.824150000000031%2C%22text%22%3A%22FINN%22%7D%2C%7B%22x%22%3A82.97411%2C%22y%22%3A390.0005%2C%22width%22%3A65.29545000000002%2C%22height%22%3A11.215660000000014%2C%22text%22%3A%22TIME%20WAIT%22%7D%2C%7B%22x%22%3A233.98186%2C%22y%22%3A422.03006%2C%22width%22%3A45.49405999999996%2C%22height%22%3A13.97699%2C%22text%22%3A%22ACK%20N%2B1%22%7D%2C%7B%22x%22%3A362.79562%2C%22y%22%3A439.07114%2C%22width%22%3A48.71428000000003%2C%22height%22%3A12.01357999999999%2C%22text%22%3A%22CLOSED%22%7D%5D%2C%22id%22%3A%22ub25d989c%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p><h2 data-lake-id=\"KVJDH\" id=\"KVJDH\"><span data-lake-id=\"ueabd13e7\" id=\"ueabd13e7\">三次握手</span></h2><p data-lake-id=\"u6759624a\" id=\"u6759624a\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F732231%2F1647677397909-c6ff04d4-8c1e-44a1-b6a7-3a602618cad5.png%22%2C%22taskId%22%3A%22ub6164320-d9a6-4ac3-97c4-4b9b38834bf%22%2C%22clientId%22%3A%22u4cf63390-cceb-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A1164%2C%22height%22%3A780%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A207135%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A1164%2C%22originHeight%22%3A780%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22CLIENT%20SERVER%20SYN1%2CSEQX%20SYN-1%2CACK%2BX%2B1%2CSEQ-Y%20ACK-Y%2B1%2CSEQ%E4%B8%89Z%20%40%E7%A8%80%E5%9C%9F%E6%8E%98%E9%87%91%E6%8A%80%E6%9C%AF%E7%A4%BE%E5%8C%BA%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A116.714294%2C%22y%22%3A50.85613%2C%22width%22%3A114.150036%2C%22height%22%3A30.741999999999997%2C%22text%22%3A%22CLIENT%22%7D%2C%7B%22x%22%3A931.6486%2C%22y%22%3A58.17124%2C%22width%22%3A112.19720000000007%2C%22height%22%3A21.241045%2C%22text%22%3A%22SERVER%22%7D%2C%7B%22x%22%3A420.21255%2C%22y%22%3A168.13483%2C%22width%22%3A272.68244999999996%2C%22height%22%3A85.60315%2C%22text%22%3A%22SYN1%2CSEQX%22%7D%2C%7B%22x%22%3A362.0013%2C%22y%22%3A331.50583%2C%22width%22%3A464.06129999999996%2C%22height%22%3A126.44934%2C%22text%22%3A%22SYN-1%2CACK%2BX%2B1%2CSEQ-Y%22%7D%2C%7B%22x%22%3A379.3094%2C%22y%22%3A535.7245%2C%22width%22%3A321.48260000000005%2C%22height%22%3A113.32709999999997%2C%22text%22%3A%22ACK-Y%2B1%2CSEQ%E4%B8%89Z%22%7D%2C%7B%22x%22%3A980.1662%2C%22y%22%3A735.5336%2C%22width%22%3A166.43909999999994%2C%22height%22%3A25.78309999999999%2C%22text%22%3A%22%40%E7%A8%80%E5%9C%9F%E6%8E%98%E9%87%91%E6%8A%80%E6%9C%AF%E7%A4%BE%E5%8C%BA%22%7D%5D%2C%22id%22%3A%22u0b0117c5%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p><blockquote data-lake-id=\"udc2c6083\" id=\"udc2c6083\" class=\"lake-alert lake-alert-tips\"><p data-lake-id=\"u34b4f2f6\" id=\"u34b4f2f6\"><span data-lake-id=\"u3244d553\" id=\"u3244d553\">作用：确认客户端和服务端的接收与发送能力是否正常</span></p></blockquote><ol list=\"u7333df63\"><li fid=\"u36b3fcb0\" data-lake-id=\"ue0c457dc\" id=\"ue0c457dc\"><span data-lake-id=\"u7f9b6e40\" id=\"u7f9b6e40\">建立连接时，客户端发送 syn 包到服务端，并进入 syn_send 状态</span></li><li fid=\"u36b3fcb0\" data-lake-id=\"u2fb48bfd\" id=\"u2fb48bfd\"><span data-lake-id=\"ud945cbe7\" id=\"ud945cbe7\">服务端收到 syn 包后，向客户端发送 syn + ack 包，服务器进入 syn_rcvd 状态</span></li><li fid=\"u36b3fcb0\" data-lake-id=\"u8ff4538b\" id=\"u8ff4538b\"><span data-lake-id=\"ucaa6db1a\" id=\"ucaa6db1a\">客户端收到服务端的 syn + ack 包后，向服务器发送 ack 确认包，发送完后，两边同时进入 establish 状态</span></li></ol><h3 data-lake-id=\"UOsVp\" id=\"UOsVp\"><span data-lake-id=\"u573356a6\" id=\"u573356a6\">总结</span></h3><ol list=\"uc22a92af\"><li fid=\"u36b3fcb0\" data-lake-id=\"u8091748e\" id=\"u8091748e\"><span data-lake-id=\"ua5f21c94\" id=\"ua5f21c94\">第一次握手：客服端发送网络包，服务端收到了。这样服务端可以得到结论：客户端的发送能力、服务端的接收能力是正常的</span></li><li fid=\"u36b3fcb0\" data-lake-id=\"u854fbab8\" id=\"u854fbab8\"><span data-lake-id=\"ueec46599\" id=\"ueec46599\">第二次握手：服务端发包，客户端收到了。这样客户端可以得到结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的。不过此时服务器并不能确认客户端的接收能力是否正常</span></li><li fid=\"u36b3fcb0\" data-lake-id=\"u4d8e35ca\" id=\"u4d8e35ca\"><span data-lake-id=\"udda4447a\" id=\"udda4447a\">第三次握手：客户端发包，服务端收到了。这样服务端可以得到结论：客户端的接收、发送能力正常，服务器自己的发送、接收能力也正常</span></li></ol><h2 data-lake-id=\"L82XP\" id=\"L82XP\"><span data-lake-id=\"udbef69aa\" id=\"udbef69aa\">四次挥手</span></h2><p data-lake-id=\"u195f492e\" id=\"u195f492e\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F732231%2F1647677428236-584045d3-e1f2-42e7-8aad-d84be434c416.png%22%2C%22taskId%22%3A%22u484c4b55-1984-43d0-aa81-fccbe49d532%22%2C%22clientId%22%3A%22u4cf63390-cceb-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A1526%2C%22height%22%3A1080%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A493723%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A1526%2C%22originHeight%22%3A1080%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%E5%9B%9B%E6%AC%A1%E5%88%86%E6%89%8B%20TCP%20FIN1%2CSEQ%20U%20FIN-WAIT-1%20%E5%85%B3%E9%97%AD%E7%AD%89%E5%BE%85(CLOSE-WAIT)%20ACK%3A1%2CSEQV%2CACKNUM2U%2B1%20FIN-WAIT-2%20FIN1%2CACK1%2CSEQW%2CACKNUMMUM-U%2B1%20%E6%9C%80%E5%90%8E%E7%A1%AE%E8%AE%A4(LAST_ACK)%20ACK%3A1%2CSEQU%2B1%2CACKNUM%E4%B8%89W%2B1%20TIME-WAIT%20%E5%85%B3%E9%97%AD%E7%8A%B6%E6%80%81%20%E5%85%B3%E9%97%AD%E7%8A%B6%E6%80%81%20%40%E7%A8%80%E5%9C%9F%E6%8D%86%E9%87%91%E6%8A%80%E6%9C%AF%E7%A4%BE%E5%8C%BA%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A596.945%2C%22y%22%3A33.89588%2C%22width%22%3A320.30914999999993%2C%22height%22%3A79.00504000000001%2C%22text%22%3A%22%E5%9B%9B%E6%AC%A1%E5%88%86%E6%89%8B%22%7D%2C%7B%22x%22%3A406.15723%2C%22y%22%3A42.24046%2C%22width%22%3A143.05126999999993%2C%22height%22%3A64.03646%2C%22text%22%3A%22TCP%22%7D%2C%7B%22x%22%3A482.19604%2C%22y%22%3A204.23723%2C%22width%22%3A253.30346000000003%2C%22height%22%3A65.00461999999999%2C%22text%22%3A%22FIN1%2CSEQ%20U%22%7D%2C%7B%22x%22%3A13.365959%2C%22y%22%3A393.00482%2C%22width%22%3A176.289051%2C%22height%22%3A30.02422999999999%2C%22text%22%3A%22FIN-WAIT-1%22%7D%2C%7B%22x%22%3A1184.8003%2C%22y%22%3A401.67905%2C%22width%22%3A327.51739999999995%2C%22height%22%3A34.657309999999995%2C%22text%22%3A%22%E5%85%B3%E9%97%AD%E7%AD%89%E5%BE%85(CLOSE-WAIT)%22%7D%2C%7B%22x%22%3A415.58176%2C%22y%22%3A410.06042%2C%22width%22%3A417.24834000000004%2C%22height%22%3A151.02067999999997%2C%22text%22%3A%22ACK%3A1%2CSEQV%2CACKNUM2U%2B1%22%7D%2C%7B%22x%22%3A33.39738%2C%22y%22%3A680.7614%2C%22width%22%3A176.59867%2C%22height%22%3A26.568070000000034%2C%22text%22%3A%22FIN-WAIT-2%22%7D%2C%7B%22x%22%3A454.49216%2C%22y%22%3A566.8334%2C%22width%22%3A539.1239899999999%2C%22height%22%3A150.83207000000004%2C%22text%22%3A%22FIN1%2CACK1%2CSEQW%2CACKNUMMUM-U%2B1%22%7D%2C%7B%22x%22%3A1156.7662%2C%22y%22%3A753.6246%2C%22width%22%3A290.8698999999999%2C%22height%22%3A32.744050000000016%2C%22text%22%3A%22%E6%9C%80%E5%90%8E%E7%A1%AE%E8%AE%A4(LAST_ACK)%22%7D%2C%7B%22x%22%3A462.52258%2C%22y%22%3A845.42926%2C%22width%22%3A479.27702000000005%2C%22height%22%3A157.48590000000002%2C%22text%22%3A%22ACK%3A1%2CSEQU%2B1%2CACKNUM%E4%B8%89W%2B1%22%7D%2C%7B%22x%22%3A39.183567%2C%22y%22%3A854.96655%2C%22width%22%3A158.74226299999998%2C%22height%22%3A27.105549999999994%2C%22text%22%3A%22TIME-WAIT%22%7D%2C%7B%22x%22%3A80.06164%2C%22y%22%3A998.51117%2C%22width%22%3A121.48706%2C%22height%22%3A33.42633000000001%2C%22text%22%3A%22%E5%85%B3%E9%97%AD%E7%8A%B6%E6%80%81%22%7D%2C%7B%22x%22%3A1148.1217%2C%22y%22%3A1003.8156%2C%22width%22%3A118.98670000000016%2C%22height%22%3A31.43539999999996%2C%22text%22%3A%22%E5%85%B3%E9%97%AD%E7%8A%B6%E6%80%81%22%7D%2C%7B%22x%22%3A1339.2548%2C%22y%22%3A1032.0188%2C%22width%22%3A160.56920000000014%2C%22height%22%3A20.17969999999991%2C%22text%22%3A%22%40%E7%A8%80%E5%9C%9F%E6%8D%86%E9%87%91%E6%8A%80%E6%9C%AF%E7%A4%BE%E5%8C%BA%22%7D%5D%2C%22id%22%3A%22u9b4b8874%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p><ol list=\"u3183db0d\"><li fid=\"uc6b54dc9\" data-lake-id=\"ua0341c25\" id=\"ua0341c25\"><span data-lake-id=\"u612f8c66\" id=\"u612f8c66\">tcp 向服务端发送 fin 包，用来关闭客户端到服务端之间的传输</span></li><li fid=\"uc6b54dc9\" data-lake-id=\"u9b8a5dce\" id=\"u9b8a5dce\"><span data-lake-id=\"uceff49f5\" id=\"uceff49f5\">服务端收到 fin 包，返回一个 ack 包</span></li><li fid=\"uc6b54dc9\" data-lake-id=\"u7e45eb8e\" id=\"u7e45eb8e\"><span data-lake-id=\"u81d82cea\" id=\"u81d82cea\">服务器关闭客户端的连接，发送一个 fin 包给客户端</span></li><li fid=\"uc6b54dc9\" data-lake-id=\"u93a22f40\" id=\"u93a22f40\"><span data-lake-id=\"u99ca82c9\" id=\"u99ca82c9\">客户端发送 ack 报文进行确认</span></li></ol><h3 data-lake-id=\"xJi4s\" id=\"xJi4s\"><span data-lake-id=\"ua9ce0691\" id=\"ua9ce0691\">总结</span></h3><p data-lake-id=\"u009616ad\" id=\"u009616ad\" style=\"text-indent: 2em\"><span data-lake-id=\"uc613f895\" id=\"uc613f895\">刚开始客户端和服务端都处于连接状态，然后某一方发起关闭请求，加入客户端发起关闭请求</span></p><ol list=\"udf3c0164\"><li fid=\"u96a72250\" data-lake-id=\"u59527b64\" id=\"u59527b64\"><span data-lake-id=\"uabf074ac\" id=\"uabf074ac\">第一次挥手：客户端发送一个 FIN 报文，报文中会只定义个序列号。此时客户端处于 FIN_WAIT1 状态</span></li><li fid=\"u96a72250\" data-lake-id=\"u8dc27923\" id=\"u8dc27923\"><span data-lake-id=\"u094fc0e1\" id=\"u094fc0e1\">第二次握手：服务端收到 FIN 之后，会发送 ACK 报文，且把客户端的序列号值 +1 作为 ACK 报文的序列号值，表明已经收到客户端的报文了，此时服务端处于 CLOSE_WAIT 状态</span></li><li fid=\"u96a72250\" data-lake-id=\"u2933cc30\" id=\"u2933cc30\"><span data-lake-id=\"u50ec5282\" id=\"u50ec5282\">第三次挥手：如果服务端也想断开连接了，和客户端的第一次挥手一样，发给 FIN 报文，且指定一个序列号。此时服务端处于 LAST_ACK 状态</span></li><li fid=\"u96a72250\" data-lake-id=\"udecf3d82\" id=\"udecf3d82\"><span data-lake-id=\"u6de5e29d\" id=\"u6de5e29d\">第四次挥手：客户端收到 FIN 之后，一样发送一个 ACK 报文作为应答，且把服务端的序列号值 +1 作为自己 ACK 报文的序列号值，此时客户端处于 TIME_WAIT 状态。需要过一段时间，以确保服务端收到自己的 ACK 报文之后才会进入 CLOSE 状态</span></li></ol>",
  "body_draft_lake": "",
  "public": 0,
  "status": 1,
  "view_status": 0,
  "read_status": 1,
  "likes_count": 0,
  "comments_count": 0,
  "content_updated_at": "2022-04-04T11:33:00.000Z",
  "deleted_at": null,
  "created_at": "2022-04-04T11:33:00.000Z",
  "updated_at": "2022-05-10T15:12:40.000Z",
  "published_at": "2022-04-04T11:33:00.000Z",
  "first_published_at": "2022-04-04T11:33:00.054Z",
  "word_count": 811,
  "cover": "https://cdn.nlark.com/yuque/0/2022/png/732231/1647345588824-8b534273-6752-4b0f-b9b5-b07c33cb5495.png",
  "description": "建立连接http 和 https 都需要在建立连接的基础上来进行数据传输当客户在浏览器输入网址并按下回车，浏览器会在浏览器 dns 缓存、本地 dns 缓存 以及 host 中寻找对应记录，如果没有获取到则会请求 dns 服务来获取对应 ip获取 ip 后，tcp 连接会进行三次握手建立连接三...",
  "custom_description": null,
  "hits": 0,
  "_serializer": "v2.doc_detail"
}