---
title: 上传100个文件，同时并发上传数量为5名如何最快完成上传
url: https://www.yuque.com/wcywxq/sd8kbc/dsbtur
---

```javascript
function loadImg(url) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {   
      resolve(url)
    }, 500)
  })
}

function limitLoad(urls, handler, limit) {
  const sequence = [...urls]
  let list = [] 
  let result = []
  list = sequence.splice(0, limit).map((v, i) => {    
    return handler(v).then(url => {     
      return {url, i}      
    })
  })
  return sequence.reduce((last, v, i) => {   
    return last.then(() => {      
      return Promise.race(list)     
    }).then((data) => {      
      list[data.i % limit] = handler(v).then(url => {        
        return {url, i: i + limit}      
      })
      result[data.i] = data.url      
    })
  }, Promise.resolve()).then(() => {    
    return Promise.all(list).then((res) => {      
      res.map(item => {
        result[item.i] = item.url
      })
      return result
    })
  })
}

limitLoad(['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15'], loadImg, 5).then(res => {
  console.log(res)
})
```
