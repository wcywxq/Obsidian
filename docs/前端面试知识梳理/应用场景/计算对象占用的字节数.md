---
title: 计算对象占用的字节数
url: https://www.yuque.com/wcywxq/pgkpvh/gx1y1y
---

核心：

- `number` 类型：`8` 字节
- `string` 类型：每个字符长度 `2` 字节
- `boolean` 类型：`4` 字节

```javascript
let ws = new WeakSet()
// 存储已经计算过的内存，避免相同引用造成的问题
function calculator(val) {
  let type = typeof val
  switch (type) {
    case "string":
      return val.length * 2
    case "boolean":
      return 4
    case "number":
      return 8
    case "object":
      if (Array.isArray(val)) {
        // 递归处理数组
        return val.map(calculator).reduce((prev, cur) => prev + cur, 0)
      } else {
        // 对象的处理
        return sizeOfObject(val)
      }
    default:
      return 0
  }
}

function sizeOfObject(obj) {
  if (obj === null) return 0
  let bytes = 0
  // 对象里的 key 也会占用内存
  let props = Object.keys(obj)
  for (let i = 0; i < props.length; i++) {
    const key = props[i]
    bytes += calculator(key)
    if (typeof obj[key] === "object" && obj[key] !== null) {
      if (ws.has(obj[key])) continue
      ws.add(obj[key])
    }
    bytes += calculator(obj[key])
  }
  return bytes
}
/** ========== 测试 ========== */
const testState = {
  a: 111,
  b: "ccc",
  2222: false,
  obj: {
    a: 1,
    b: 2
  }
}
console.log(sizeOfObject(testState))
```
