---
title: 函数柯理化
url: https://www.yuque.com/wcywxq/pgkpvh/yo9cx5
---

<a name="AgY5j"></a>

## 什么是柯理化

函数柯里化指的是一种将使用多个参数的一个函数转换成一系列使用一个参数的函数的技术。(函数柯理化的基础是**闭包**) <a name="RF79V"></a>

### 实现

```javascript
// es6 实现
function curry(fn, ...args) {
	return fn.length <= args.length ? fn(...args) : curry.bind(null, fn, ...args)
}

function curry(fn) {
  return function curryInset(...args) {
    if (fn.length <= args.length) {
      return fn.apply(this, args)
    } else {
      return function(...subArgs) {
        return curryInset.apply(this, args.concat(subArgs))
      }
    }
  }
}
```

<a name="VnmFo"></a>

## lodash 中的柯理化

调用方法: `_.curry(fn)`

- 功能: 创建一个函数, 该函数接收一个或多个 `fn` 的参数, 如果 `fn` 所需要的参数都被提供则执行 `fn` 并返回执行的结果。否则继续返回该函数并等待接收剩余的参数
- 参数: 需要柯理化的函数
- 返回值: 柯理化后的函数
- 示例:

```javascript
// 参数是一个的为一元函数，两个的是二元函数
// 柯里化可以把一个多元函数转化成一元函数
function sum (a, b, c) {
  return a + b + c
}
// 定义一个柯里化函数
const curried = _.curry(sum)

// 如果输入了全部的参数，则立即返回结果
console.log(curried(1, 2, 3)) // 6

// 如果传入了部分的参数，此时它会返回当前函数，并且等待接收 sum 中的剩余参数
console.log(curried(1)(2, 3)) // 6
console.log(curried(1, 2)(3)) // 6
```

<a name="eyN1H"></a>

## 手写 lodash 中的柯理化函数

- 接受一个纯函数入参, 返回柯里化后的函数
- 如果传入 `包装后的柯理化函数` 参数个数与 `需要柯理化的函数` 参数相同, 即一次传入全部参数，`包装后的柯理化函数` 会立即执行
- 如果传入 `包装后的柯理化函数` 参数个数小于 `包装后的柯理化函数` 参数，会返回一个新的函数，等待剩余需要的参数全部传入，才会执行。如果还是没有传递完所需参数，会继续上面过程，返回一个新的函数，直到全部参数接收完毕

```javascript
function curry(fn) {
  // curryInset 为柯理化生产的新函数
  // 因为要递归实现, 所以用具名函数
	return function curryInset(...args) {
  	if (args.length < fn.length) {
      return function() {
      	// 之前传入的参数都储存在 args 中
        // 合并参数并递归执行
      	return curryInset(...args.concat(Array.from(...arguments)))
      }
    }
    return fn(...args)
  }
}
```

<a name="wUeP2"></a>

## 柯理化实战案例

我们工作中经常遇到各种需要正则校验的需求，例如在提交用户信息的时候校验手机号、邮箱等。

- 封装一个校验函数：

```javascript
// 非柯里化版本
function checkByRegExp(regExp,string) {
  return regExp.test(string);  
}

checkByRegExp(/^1\d{10}$/, '15010001000'); // 校验电话号码
checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@163.com'); // 校验邮箱
```

- 在实际使用中，其实我们不需要去关注正则是如何匹配的，只需要使用更具体函数去分别校验手机号或者邮箱，这里就需要我们使用柯里化函数处理一下：

```javascript
// 进行柯里化
let _check = curry(checkByRegExp);
// 生成工具函数，验证电话号码
let checkCellPhone = _check(/^1\d{10}$/);
// 生成工具函数，验证邮箱
let checkEmail = _check(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/);

checkCellPhone('18642838455'); // 校验电话号码
checkCellPhone('13109840560'); // 校验电话号码
checkCellPhone('13204061212'); // 校验电话号码

checkEmail('test@163.com'); // 校验邮箱
checkEmail('test@qq.com'); // 校验邮箱
checkEmail('test@gmail.com'); // 校验邮箱
```
