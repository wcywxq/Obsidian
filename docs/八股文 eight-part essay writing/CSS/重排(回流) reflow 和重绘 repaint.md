---
title: 重排(回流) reflow 和重绘 repaint
url: https://www.yuque.com/wcywxq/mxunh7/vm3nkg
---

<a name="zMvgK"></a>

## 概念

<a name="pA18D"></a>

### 重排(回流)

当渲染树中部分或者全部元素的尺寸、结构或者属性发生变化时，浏览器会重新渲染部分或者全部文档的过程就称为**回流**。

**导致重排(回流)的操作**

- 页面的首次渲染
- 浏览器的窗口发生变化
- 元素的内容发生变化
- 元素的尺寸或者位置发生变化
- 元素的字体大小发生变化
- 激活 css 伪类
- 查询某些属性或者调用某些方法
- 添加或删除可见的 dom 元素

在触发重排(回流)的时候，由于浏览器渲染页面是基于流式布局的，所以当触发回流时，会导致周围的 dom 元素重新排列，它的影响范围有两种：

- 全局范围：从根节点开始，对整个渲染树进行重新布局
- 局部范围：对渲染树的某部分或者一个渲染对象进行重新布局 <a name="aWn8k"></a>

### 重绘

当页面中某些元素的样式发生改变，但是不会影响其在文档流中的位置时，浏览器就会对元素进行重新绘制，这个过程就是**重绘**。
**导致重新绘的操作**

- color、background 相关属性：background-color、background-image 等
- outline 相关属性：outline-color、outline-width、text-decoration
- border-radius、visibility、box-shadow
  :::warning
  注意：
  触发回流时，一定会触发重绘，但是重绘不一定会触发回流
  ::: <a name="Qolwn"></a>

## 避免回流与重绘的方式

- 操作 dom 时，尽量在低层级的 dom 节点进行操作
- 不要使用 table 布局，一个小的改动可能会使整个 table 重新布局
- 使用 css 的表达式
- 不要频繁操作元素的样式，对于静态页面，可以修改类名，而不是样式。(即样式几种改变、使用添加新样式类名)
- 使用 absolute 或者 fixed，使元素脱离文档流，这样他们发生变化就不会影响其他元素
- 避免频繁操作 dom，可以创建一个文档片段 documentFragment，在它上面应用所有 dom 操作，最后再把它添加到文档中
- 开启 GPU 加速，利用 css 属性 transform、will-change 等
- 将元素先设置 `display: none`，操作结束后再把它显示出来。因为在 display 属性为 none 的元素上进行的 dom 操作不会引发回流和重绘
- 将 dom 的多个读操作(或者写操作)放在一起，而不是读写操作穿插着写。这得益于**浏览器渲染队列机制**

浏览器会将所有的回流、重绘操作放在一个队列中，当队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会对队列进行批处理。这样就会让多次的回流、重绘变成一次回流重绘
