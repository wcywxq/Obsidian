---
title: npm、yarn、pnpm
url: https://www.yuque.com/wcywxq/mxunh7/nvbtiy
---

<a name="pnyR9"></a>

## npm

`package-lock.json`采用的是`JSON`的结构

- `npm v2`

`npm v2`会安装每一个包所依赖的所有依赖项，然而这个结构可能会很长。这对于基于`unix`的操作系统来说只不过是一个小烦恼，但对于`windows`来说是个破坏性的东西，因为有很多程序无法处理超过`260`个字符的文件路径名

- `npm v3`

`npm v3`采用了扁平依赖关系树来解决`npm v2`的问题。但这种做法的缺点是，`npm`必须首先遍历所有的项目依赖关系，然后再决定如何扁平的`node_modules`目录结构，`npm`必须为所有使用到的模块构建一个完整的依赖关系树，这是一个耗时的操作，也是`npm`安装速度慢的一个很重要的原因。

- `npm v5`

`npm v5`使`npm`向前迈进了一大步，在几乎所有常见情况下显著提高了其性能，重写了 `cache`，支持并发访问，对离线模式及缓存安装进行了优化 <a name="ohw07"></a>

## yarn

`yarn`最开始的主要目标是解决`npm v3`中由于语义版本控制而导致的`npm`安装的不确定性问题，虽然可以使用`npm shrinkwrap`来实现可预测的依赖关系树，但它并不是默认选项，而是需要手动开启这个选项。

`yarn`采用了不同的做法，每个`yarn`安装都会生成一个类似于`npm-shrinkwrap.json`的`yarn.lock`文件，而且它是默认创建的，除了常规信息之外，`yarn.lock`文件还包含要安装的内容校验和，以确保使用的库和版本相同

和`npm`一样，`yarn`使用本地缓存，与`npm`不同的是，`yarn`无需互联网连接就能安装本地缓存的依赖项，它提供了**离线模式**。

`yarn`还提供了一些其他改进，它允许合并项目中使用到的所有的包的许可证 <a name="ebbiJ"></a>

## pnpm

`pnpm`利用硬链接和符号链接来避免复制所有本地缓存源文件，这是`yarn`的最大性能弱点之一 <a name="JCiw1"></a>

## 对比

- npm2 是通过嵌套的方式管理 node\_modules 的，会有同样的依赖复制多次的问题。
- npm3+ 和 yarn 是通过铺平的扁平化的方式来管理 node\_modules，解决了嵌套方式的部分问题，但是引入了幽灵依赖的问题，并且同名的包只会提升一个版本的，其余的版本依然会复制多次。
- pnpm 则是用了另一种方式，不再是复制了，而是都从全局 store 硬连接到 node\_modules/.pnpm，然后之间通过软链接来组织依赖关系。这样不但节省磁盘空间，也没有幽灵依赖问题，安装速度还快，从机制上来说完胜 npm 和 yarn。
